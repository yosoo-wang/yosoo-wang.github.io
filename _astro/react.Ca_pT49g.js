import{r as D,R as K}from"./index.BufDd4G-.js";let N=0;function ae(e,u){const l=`atom${++N}`,E={toString:()=>l};return typeof e=="function"?E.read=e:(E.init=e,E.read=Y,E.write=Z),u&&(E.write=u),E}function Y(e){return e(this)}function Z(e,u,l){return u(this,typeof l=="function"?l(e(this)):l)}const L=(e,u)=>e.unstable_is?e.unstable_is(u):u===e,k=e=>"init"in e,j=e=>!!e.write,O=new WeakMap,Q=(e,u)=>{O.set(e,u),e.catch(()=>{}).finally(()=>O.delete(e))},C=(e,u)=>{const l=O.get(e);l&&(O.delete(e),l(u))},W=(e,u)=>{e.status="fulfilled",e.value=u},z=(e,u)=>{e.status="rejected",e.reason=u},ee=e=>typeof e?.then=="function",P=(e,u)=>!!e&&"v"in e&&"v"in u&&Object.is(e.v,u.v),q=(e,u)=>!!e&&"e"in e&&"e"in u&&Object.is(e.e,u.e),w=e=>!!e&&"v"in e&&e.v instanceof Promise,te=(e,u)=>"v"in e&&"v"in u&&e.v.orig&&e.v.orig===u.v.orig,T=e=>{if("e"in e)throw e.e;return e.v},ne=()=>{const e=new WeakMap,u=new WeakMap,l=[],E=new WeakMap;let y,U;const p=t=>e.get(t),R=(t,i)=>{i.d.forEach((c,r)=>{var s;if(!E.has(r)){const o=p(r);(s=l[l.length-1])==null||s.add(r),E.set(r,[o,new Set]),o&&R(r,o)}E.get(r)[1].add(t)})},A=(t,i)=>{var c;const r=p(t);if(e.set(t,i),E.has(t)||((c=l[l.length-1])==null||c.add(t),E.set(t,[r,new Set]),R(t,i)),w(r)){const s="v"in i?i.v instanceof Promise?i.v:Promise.resolve(i.v):Promise.reject(i.e);r.v!==s&&C(r.v,s)}},v=(t,i,c,r)=>{const s=new Map(r?i.d:null);let o=!1;c.forEach((n,d)=>{!n&&L(t,d)&&(n=i),n&&(s.set(d,n),i.d.get(d)!==n&&(o=!0))}),(o||i.d.size!==s.size)&&(i.d=s)},_=(t,i,c,r)=>{const s=p(t),o={d:s?.d||new Map,v:i};if(c&&v(t,o,c,r),P(s,o)&&s.d===o.d)return s;if(w(s)&&w(o)&&te(s,o)){if(s.d===o.d)return s;o.v=s.v}return A(t,o),o},F=(t,i,c,r)=>{if(ee(i)){let s;const o=()=>{const d=p(t);if(!w(d)||d.v!==n)return;const a=_(t,n,c);u.has(t)&&d.d!==a.d&&X(t,a,d.d)},n=new Promise((d,a)=>{let f=!1;i.then(S=>{f||(f=!0,W(n,S),d(S),o())},S=>{f||(f=!0,z(n,S),a(S),o())}),s=S=>{f||(f=!0,S.then(h=>W(n,h),h=>z(n,h)),d(S))}});return n.orig=i,n.status="pending",Q(n,d=>{d&&s(d),r?.()}),_(t,n,c,!0)}return _(t,i,c)},$=(t,i,c)=>{const r=p(t),s={d:r?.d||new Map,e:i};return c&&v(t,s,c),q(r,s)&&r.d===s.d?r:(A(t,s),s)},g=(t,i)=>{const c=p(t);if(!i&&c&&(u.has(t)||Array.from(c.d).every(([f,S])=>{if(f===t)return!0;const h=g(f);return h===S||P(h,S)})))return c;const r=new Map;let s=!0;const o=f=>{if(L(t,f)){const h=p(f);if(h)return r.set(f,h),T(h);if(k(f))return r.set(f,void 0),f.init;throw new Error("no atom init")}const S=g(f);return r.set(f,S),T(S)};let n,d;const a={get signal(){return n||(n=new AbortController),n.signal},get setSelf(){return!d&&j(t)&&(d=(...f)=>{if(!s)return I(t,...f)}),d}};try{const f=t.read(o,a);return F(t,f,r,()=>n?.abort())}catch(f){return $(t,f,r)}finally{s=!1}},x=t=>T(g(t)),G=t=>{const i=n=>{var d,a;const f=new Set((d=u.get(n))==null?void 0:d.t);return(a=E.get(n))==null||a[1].forEach(S=>{f.add(S)}),f},c=new Array,r=new Set,s=n=>{if(!r.has(n)){r.add(n);for(const d of i(n))n!==d&&s(d);c.push(n)}};s(t);const o=new Set([t]);for(let n=c.length-1;n>=0;--n){const d=c[n],a=p(d);if(!a)continue;let f=!1;for(const S of a.d.keys())if(S!==d&&o.has(S)){f=!0;break}if(f){const S=g(d,!0);P(a,S)||o.add(d)}}},B=(t,...i)=>{const c=o=>T(g(o)),r=(o,...n)=>{const d=l.length>0;d||l.push(new Set([o]));let a;if(L(t,o)){if(!k(o))throw new Error("atom not writable");const f=p(o),S=F(o,n[0]);P(f,S)||G(o)}else a=B(o,...n);if(!d){const f=M(l.pop())}return a};return t.write(c,r,...i)},I=(t,...i)=>{l.push(new Set([t]));const c=B(t,...i),r=M(l.pop());return c},m=(t,i,c)=>{var r;const s=u.get(t);if(s)return i&&s.t.add(i),s;const o=c||[];(r=p(t))==null||r.d.forEach((d,a)=>{a!==t&&m(a,t,o)}),g(t);const n={t:new Set(i&&[i]),l:new Set};if(u.set(t,n),j(t)&&t.onMount){const{onMount:d}=t;o.push(()=>{const a=d((...f)=>I(t,...f));a&&(n.u=a)})}return c||o.forEach(d=>d()),n},H=(t,i)=>!i.l.size&&(!i.t.size||i.t.size===1&&i.t.has(t)),b=(t,i)=>{if(!H(t,i))return;const c=i.u;c&&c(),u.delete(t);const r=p(t);r&&(w(r)&&C(r.v),r.d.forEach((s,o)=>{if(o!==t){const n=u.get(o);n&&(n.t.delete(t),b(o,n))}}))},X=(t,i,c)=>{const r=new Set(i.d.keys()),s=new Set;c?.forEach((o,n)=>{if(r.has(n)){r.delete(n);return}s.add(n);const d=u.get(n);d&&d.t.delete(t)}),r.forEach(o=>{m(o,t)}),s.forEach(o=>{const n=u.get(o);n&&b(o,n)})},M=t=>{let i;const c=[],r=s=>{var o;if(!E.has(s))return;const[n,d]=E.get(s);E.delete(s),c.push([s,n]),d.forEach(r),(o=p(s))==null||o.d.forEach((a,f)=>r(f))};t.forEach(r),c.forEach(([s,o])=>{const n=p(s);if(n&&n!==o){const d=u.get(s);d&&n.d!==o?.d&&X(s,n,o?.d),d&&!(!w(o)&&(P(o,n)||q(o,n)))&&d.l.forEach(a=>a())}})};return{get:x,set:I,sub:(t,i)=>{const c=m(t),r=M([t]),s=c.l;return s.add(i),()=>{s.delete(i),b(t,c)}}}};let V;const oe=()=>(V||(V=ne()),V),se=oe,re=D.createContext(void 0),J=e=>{const u=D.useContext(re);return e?.store||u||se()},ie=e=>typeof e?.then=="function",ue=K.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(e.status="pending",e.then(u=>{e.status="fulfilled",e.value=u},u=>{e.status="rejected",e.reason=u}),e)});function de(e,u){const l=J(u),[[E,y,U],p]=D.useReducer(v=>{const _=l.get(e);return Object.is(v[0],_)&&v[1]===l&&v[2]===e?v:[_,l,e]},void 0,()=>[l.get(e),l,e]);let R=E;(y!==l||U!==e)&&(p(),R=l.get(e));const A=u?.delay;return D.useEffect(()=>{const v=l.sub(e,()=>{if(typeof A=="number"){setTimeout(p,A);return}p()});return p(),v},[l,e,A]),D.useDebugValue(R),ie(R)?ue(R):R}function ce(e,u){const l=J(u);return D.useCallback((...y)=>l.set(e,...y),[l,e])}function Se(e,u){return[de(e,u),ce(e,u)]}export{ce as a,ae as b,Se as c,de as u};
